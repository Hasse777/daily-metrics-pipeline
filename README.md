# üß© Data Pipeline for Financial Transactions

## üìò –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

–ü—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –ø–æ–ª–Ω–æ–≥–æ –ø–∞–π–ø–ª–∞–π–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –≤ —Ä–∞–∑–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∞—Ö –∏ –≤–∞–ª—é—Ç–∞—Ö.
–°–∏—Å—Ç–µ–º–∞ —Å–æ–±–∏—Ä–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ (PostgreSQL), –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∏—Ö –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö Vertica, —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç —Å–ª–æ–∏ **STG**, **DDS** –∏ –∏—Ç–æ–≥–æ–≤—É—é –≤–∏—Ç—Ä–∏–Ω—É —Å –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π.

–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –µ–¥–∏–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –º–µ—Ç—Ä–∏–∫ **`global_metrics`**, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å:

* –µ–∂–µ–¥–Ω–µ–≤–Ω—É—é –¥–∏–Ω–∞–º–∏–∫—É —Å—É–º–º –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –≤ —Ä–∞–∑–Ω—ã—Ö –≤–∞–ª—é—Ç–∞—Ö;
* —Å—Ä–µ–¥–Ω–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è;
* –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤, —Å–æ–≤–µ—Ä—à–∞—é—â–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–∏;
* –æ–±—â–∏–π –æ–±–æ—Ä–æ—Ç –∫–æ–º–ø–∞–Ω–∏–∏ –≤ –¥–æ–ª–ª–∞—Ä–∞—Ö –°–®–ê.

---

## ‚öôÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–∞–π–ø–ª–∞–π–Ω–∞

**–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö:** PostgreSQL
**–ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π —Å–ª–æ–π:** STG (—Å—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ, –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ `COPY`)
**–û—Å–Ω–æ–≤–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ:** Vertica (–º–æ–¥–µ–ª—å Data Vault 2.0 ‚Äî —Ö–∞–±—ã, –ª–∏–Ω–∫–∏, —Å–∞—Ç–µ–ª–ª–∏—Ç—ã)
**–í–∏—Ç—Ä–∏–Ω–∞ –¥–∞–Ω–Ω—ã—Ö:** `global_metrics` ‚Äî –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∞–≥—Ä–µ–≥–∞—Ç—ã
**–û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è:** Apache Airflow

* `load_data_to_stg_DAG.py` ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –≤ STG
* `load_data_to_dds_DAG.py` ‚Äî –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ª–æ—è DDS
* `load_mart_DAG.py` ‚Äî —Ä–∞—Å—á—ë—Ç –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∏—Ç—Ä–∏–Ω—ã `global_metrics`

---

## üìä –ò—Ç–æ–≥–æ–≤–∞—è –≤–∏—Ç—Ä–∏–Ω–∞ `global_metrics`

| –ü–æ–ª–µ                             | –û–ø–∏—Å–∞–Ω–∏–µ                                      |
| -------------------------------- | --------------------------------------------- |
| `date_update`                    | –î–∞—Ç–∞ —Ä–∞—Å—á—ë—Ç–∞                                  |
| `currency_from`                  | –ö–æ–¥ –≤–∞–ª—é—Ç—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏                         |
| `amount_total`                   | –û–±—â–∞—è —Å—É–º–º–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø–æ –≤–∞–ª—é—Ç–µ (–≤ –¥–æ–ª–ª–∞—Ä–∞—Ö) |
| `cnt_transactions`               | –û–±—â–∏–π –æ–±—ä—ë–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø–æ –≤–∞–ª—é—Ç–µ              |
| `avg_transactions_per_account`   | –°—Ä–µ–¥–Ω–∏–π –æ–±—ä—ë–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Å –æ–¥–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞    |
| `cnt_accounts_make_transactions` | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤ —Å –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏  |

---

## üß† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

* **Vertica** ‚Äî –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö
* **Airflow** ‚Äî –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è ETL-–ø—Ä–æ—Ü–µ—Å—Å–æ–≤
* **PostgreSQL** ‚Äî –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö
* **Python** ‚Äî —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è DAG-—Å–∫—Ä–∏–ø—Ç–æ–≤
* **SQL / Data Vault 2.0** ‚Äî –º–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö –∏ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏

---

## üöÄ –†–µ–∑—É–ª—å—Ç–∞—Ç

–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π ETL-–ø—Ä–æ—Ü–µ—Å—Å, –∫–æ—Ç–æ—Ä—ã–π –µ–∂–µ–¥–Ω–µ–≤–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫—É—é –≤–∏—Ç—Ä–∏–Ω—É –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –±–∏–∑–Ω–µ—Å –º–µ—Ç—Ä–∏–∫–∞–º–∏
–¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –¥–∏–Ω–∞–º–∏–∫–∏ –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –ø–æ —Å—Ç—Ä–∞–Ω–∞–º –∏ –≤–∞–ª—é—Ç–∞–º.

---

## üñº –ü—Ä–∏–º–µ—Ä—ã –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è

**1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ (–º–æ–¥–µ–ª—å Data Vault 2.0)**  
–î–∏–∞–≥—Ä–∞–º–º–∞ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Å–ª–æ—ë–≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ ‚Äî —Ö–∞–±—ã, –ª–∏–Ω–∫–∏ –∏ —Å–∞—Ç–µ–ª–ª–∏—Ç—ã, —Å–≤—è–∑—ã–≤–∞—é—â–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –∞–∫–∫–∞—É–Ω—Ç—ã, —Å—Ç—Ä–∞–Ω—ã –∏ –≤–∞–ª—é—Ç—ã.

![Data Vault Schema](https://github.com/Hasse777/daily-metrics-pipeline/blob/main/examples/schema.png)

---

**2. –ü—Ä–∏–º–µ—Ä –≤–∏—Ç—Ä–∏–Ω—ã `global_metrics`**  
–ü—Ä–∏–º–µ—Ä –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∑–∞ –æ–∫—Ç—è–±—Ä—å 2022 –≥–æ–¥–∞ ‚Äî –∏—Ç–æ–≥–æ–≤–∞—è –≤–∏—Ç—Ä–∏–Ω–∞ –ø–æ—Å–ª–µ —Ä–∞—Å—á—ë—Ç–∞ DAG `load_mart_DAG.py`.

![Global Metrics Example](https://github.com/Hasse777/daily-metrics-pipeline/blob/main/examples/global_metrics_sample.png)
